#!/bin/bash

:notify() {
    notify-send.sh -r 1000 -t 1000 " " -- "$*"
}

:body-append() {
    body="${body}${endl}${@}"
}

:main() {
    local datetime=""
    local battery=""
    local body=""

    local endl=$'\n'

    datetime=$(date +'%T %d-%m-%Y %A')
    battery=$(acpi \
        | sed -r 's/Battery [0-9]:\s*//' \
        | sed -r 's/ until charged//' \
        | sed -r 's/ remaining//'
    )

    body="${datetime}"
    :body-append "${battery}"

    :notify "$body"

    local yota_status="$(yota-status)"
    if [[ "$yota_status" ]]; then
        :body-append "$yota_status"

        :notify "$body"
    fi

    local location=$(my-location)
    if [[ "$location" ]]; then
        location=($location)
        if [[ "${location[0]}" == "${location[1]}" ]]; then
            :body-append "${location[0]}"
        else
            :body-append "${location[0]}: ${location[1]}"
        fi

        :notify "$body"
    fi

}

:main "${@}"
