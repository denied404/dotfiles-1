#!/bin/bash

which zfs &>/dev/null
if [ $? -ne 0 ]; then
    exit 0
fi

set -euo pipefail

:log() {
    printf "$(highlight bold)Â» zfs: %s$(highlight reset)\n" "$*"
}

:main() {
    local pool
    local snapshot

    pool="zfsroot"
    snapshot="$pool@backup_$(datename)"

    :log "creating snapshot $snapshot"
    sudo zfs snapshot $snapshot

    zfs-destroy-old-snapshots
}

:main "${@}"
