#!/bin/bash

exec 200>/tmp/brightness.lock
flock 200

if [ "$(cat ~/.config/profile)" == "laptop" ]; then
    dir=/sys/class/backlight/intel_backlight
    step=100
else
    dir=/sys/class/backlight/acpi_video0
    step=1
fi

path=$dir/brightness
value=$(cat $path)

:notify() {
    notify-send.sh -r 2000 "brightness" "${1}"
}

if [ $# -eq 0 ]; then
	echo $value
elif [ $1 == "up" ]; then
    new_value=$(($value+$step))
	echo "$new_value" | sudo tee $dir/brightness
    :notify "$new_value"
elif [ $1 == "down" ]; then
    new_value=$(($value-$step))
	echo "$new_value" | sudo tee $dir/brightness
    :notify "$new_value"
fi
