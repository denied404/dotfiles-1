#!/bin/sudo /bin/bash

set -euo pipefail

if pgrep -f "pppd call office" >/dev/null; then
    echo -n "stopping ppp provider..."
    poff office
    echo "ok"
fi

echo -n "switching network to local..."
resolv-switch local
echo "ok"

echo -n "starting ppp provider..."
pon office
echo "ok"

echo -n "establishing ppp connection"
while ! ip l | grep -v DOWN | grep -q ppp0; do
    echo -n "."
    sleep 0.1;
done
echo "ok"

echo -n "switching network to office..."
resolv-switch office
echo "ok"
