#!/bin/bash


symlinks=($(cat ~/dotfiles/.symlinks))
clones=($(cat ~/dotfiles/.clones))

for path in "${symlinks[@]}"; do
    echo "$path" >&2
    rm -rf ~/"$path"
    ln -s ~/dotfiles/"$path" ~/"$path"
done

for path in "${clones[@]}"; do
    echo "$path" >&2
    rm -rf ~/"$path"
    cp -r ~/dotfiles/"$path" ~/"$path"
done

(
    cd $HOME/dotfiles/rootfs/
    find . -type f -printf '%P\n' | while read filename; do
        echo "/$filename" >&2

        if [[ ! -d /"$(dirname "$filename")" ]]; then
            sudo mkdir -p /"$(dirname "$filename")"
        fi

        sudo cp ./"$filename" /"$filename"
    done
)
