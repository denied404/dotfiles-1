#!/bin/bash

exec 200>/tmp/volume.lock
flock 200

action="$1"

if [ -f ~/.android-volume ]; then
    adb_devices_stub_lines=2

    adb_lines_count=$(adb devices | wc -l)

    if [[ $adb_lines_count > $adb_devices_stub_lines ]]; then
        exec android-volume $@
    fi
fi

case $action in
    up)
        amixer -M set Master 2%+
    ;;

    down)
        amixer -M set Master 2%-
    ;;
esac

volume=(
    $(amixer get Master | grep % | awk '{print $5}' | sed 's/[^0-9]//g')
)


if [[ "${volume[0]}" != "${volume[1]}" ]]; then
    value="${volume[0]} & ${volume[1]}"
else
    value="${volume[0]}"
fi

notify-send.sh -r 300 -t 100 " " -- "Volume: ${value}"
