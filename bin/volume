#!/bin/bash

exec 200>/tmp/volume.lock
flock 200

:main() {
    local action=$1

    local status="$(:change "$action")"

    local volume=$(:parse-volume "$status")

    :notify "$volume"
}

:notify() {
    local value=$1
    notify-send.sh -r 300 -t 100 " " -- "Volume: ${value}"
}

:change() {
    local action=$1

    case $action in
        up)
            amixer -M set Master 2%+
        ;;

        down)
            amixer -M set Master 2%-
        ;;
    esac
}

:parse-volume() {
    volumes=($(echo "${@}" | grep -Po '[0-9]+%'))
    if [[ "${volumes[1]}" && "${volumes[1]}" != "${volumes[0]}" ]]; then
        echo "L:${volumes[0]} R:${volumes[1]}"
    fi

    echo "${volumes[0]}"
}

:main "${@}"
