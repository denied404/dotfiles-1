#!/bin/bash

#set -x

input() {
    i3-input -F '#%s' | \
        tail -n 3      | \
        grep output    | \
        cut -d'=' -f2
}

if [[ "$1" != "" ]]; then
    INPUT="$1"
else
    INPUT=$(input)
fi

WORDS=$(wc -w <<< "$INPUT")

LANG="en-ru"
TEXT_AZ=$(grep -E '[a-zA-Z]' <<< "$INPUT")
if [[ "$TEXT_AZ" == "" ]]; then
    LANG="ru-en"
fi

if [[ $WORDS == 1 ]]; then
    TRANSLATION=$(~/go/bin/runki --dry --lang $LANG 2>/dev/null <<< "$INPUT")

    if [[ "$TRANSLATION" != "" ]]; then
        runki --lang $LANG <<< "$INPUT" >/dev/null 2>&1 &
    fi
fi

if [[ "$TRANSLATION" == "" ]]; then
    INPUT=$(tr -s ' ' '+' <<< "$INPUT")
    URL="http://translate.yandex.net/api/v1/tr.json/translate?lang=$LANG&text=$INPUT&srv=tr-text"
    TRANSLATION=$(curl -s "$URL" | jq .text[0] | sed 's/"//g')
fi

notify-send -t 2000 "$TRANSLATION"

exit 0
