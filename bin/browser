#!/bin/bash

set -x

browsers=("google-chrome-stable" "firefox-beta")

url=$(sed -r 's#^(git+ssh|ssh|git)://(\w+@)?##' <<< "$1")
params="${@:2}"

scheme=$(grep -Po '^\w+://' <<< "$url")
if [[ "$scheme" != "http://"
   && "$scheme" != "https://"
   && "$scheme" != "ftp://"
   && "$scheme" != "file://"
   && "$scheme" != "" ]]; then
    notify-send "URL" "$url"

    exit
fi

:open() {
    local browser="$1"

    systemd-cat -t "browser" <<< "${browser} ${url} ${params[@]}"

    if [[ "$browser" == "firefox-beta" ]]; then
        exec firefox-beta-bin "$url" ${params[@]}
    else
        exec "$browser" "$url" ${params[@]}
    fi
}

for browser in ${browsers[@]}; do
    check="$browser"
    if [[ "$browser" == "google-chrome-stable" ]]; then
        check="chrom"
    fi
    if pgrep -f "$check"; then
        :open "$browser"
        exit 0
    fi
done

:open "${browsers[0]}"
