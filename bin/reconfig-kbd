#!/bin/bash

export XAUTHORITY=~/.Xauthority
export DISPLAY=${DISPLAY:-:0.0}

xset r rate 110 100

KEYCODES="evdev+aliases(qwerty)+hjkl"
COMPAT="complete+hjkl"
SYMBOLS=(
    "pc"
    "us"
    "ru:2"

    "level3(lwin_switch)"
    "mod4-lvl3"

    "hjkl"
    "hjkl(caret)"
    "hjkl(rctrl-rshift)"
    "hjkl(fast-enter)"
    "hjkl(fast-escape)"


    "capslock(escape)"
    "altwin(swap_alt_win)"
    #"bksp-last-group"
    #"ralt-first-group"

    "hjkl(fast-numpad)"
    "level5(ralt_switch)"
    #"hjkl(rtrn_switch)"
)

SYMBOLS=$(IFS="+"; echo "${SYMBOLS[*]}")

if [[ "$1" == "-v" ]]; then
    setxkbmap -keycodes $KEYCODES -symbols $SYMBOLS -compat $COMPAT \
        -print | xkbcomp - :0
else
    if [[ "$1" == "-r" ]]; then
        sudo rm -rf /var/lib/xkb/*
    fi

    setxkbmap -keycodes $KEYCODES -symbols $SYMBOLS -compat $COMPAT
fi
